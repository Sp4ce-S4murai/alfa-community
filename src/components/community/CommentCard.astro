---
import UserAvatar from '@components/community/UserAvatar.astro';
import type { User } from '@supabase/supabase-js';

// 1. A prop agora é o objeto 'comment' inteiro
interface Props {
  comment: any; // Ex: { id, content, created_at, profiles: { ... } }
}
const { comment } = Astro.props;

// 2. Lógica movida para o script (à prova de pânico)
const author = comment.profiles;
const avatarUrl = author?.avatar_url;
const authorName = author?.full_name || 'Usuário';
const authorHandle = author?.handle ? `@${author.handle}` : '';
const authorProfileLink = author?.handle ? `/perfil/${author.handle}` : '#';

// 3. Formatação simples de data (podemos melhorar depois)
const timestamp = new Date(comment.created_at).toLocaleString('pt-BR', {
  day: '2-digit',
  month: 'short',
  hour: '2-digit',
  minute: '2-digit'
});
---

<div class="flex gap-3 p-4 border-b border-zinc-700 last:border-b-0">
  
  <div class="flex-shrink-0">
    <UserAvatar src={avatarUrl} alt={authorName} size="small" />
  </div>

  <div class="flex-1">
    <div class="flex items-center gap-2 flex-wrap">
      <a href={authorProfileLink} class="font-semibold text-zinc-100 hover:underline">
        {authorName}
      </a>
      <span class="text-sm text-zinc-400">
        {authorHandle}
      </span>
      <span class="text-xs text-zinc-500">
        · {timestamp}
      </span>
    </div>
    
    <p class="mt-2 text-zinc-200 whitespace-pre-wrap">
      {comment.content}
    </p>
  </div>
</div>