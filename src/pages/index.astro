---
import BaseLayout from '../layouts/BaseLayout.astro';
import StatsCard from '../components/ui/StatsCard.astro';
import PostCard from '../components/community/PostCard.astro';
import { mockUsersNew, mockPostsNew } from '../lib/mockData';
import NewPostForm from '@components/community/NewPostForm.astro';

// Lógica para os stats
const totalMembros = mockUsersNew.length;
const totalPosts = mockPostsNew.length;
const totalOnline = 0; // pode ser fixo por agora
---

<BaseLayout title="Alfa Community - Home" description="Bem-vindo à comunidade de desenvolvedores Alfa">
  <main class="min-h-screen bg-zinc-900">
    <div class="container mx-auto px-4 py-8">
      <header class="text-center mb-12">
        <h1 class="text-5xl font-bold text-white mb-4">Alfa Community</h1>
        <p class="text-xl text-zinc-300">Conectando desenvolvedores e compartilhando conhecimento</p>
      </header>

      <div class="max-w-4xl mx-auto">
        <!-- Seção Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
          <StatsCard value={totalMembros} label="Membros" />
          <StatsCard value={totalPosts} label="Posts" />
          <StatsCard value={totalOnline} label="Online" />
        </div>

        <NewPostForm class="mb-6" />

        <!-- Seção Feed -->
        <div class="space-y-4">
          <h3 class="text-xl font-semibold text-white mb-4">Posts Recentes</h3>
          {mockPostsNew.map(post => {
            const author = mockUsersNew.find(user => user.id === post.authorId);
            if (!author) return null; // Tratamento de erro simples
            
            return (
              <PostCard 
                authorName={author.name}
                authorHandle={author.handle}
                avatarUrl={author.avatarUrl}
                postContent={post.content}
                likesCount={post.likes}
                commentsCount={post.comments}
                tags={post.tags}
                postId={post.id}
              />
            );
          })}
        </div>
      </div>
    </div>
  </main>
</BaseLayout>
